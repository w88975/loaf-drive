# 🎬 视频播放器调试指南

## 当前状态

✅ **CanvasVideo 组件已完成以下功能：**

### 播放器控制
- ✅ 播放/暂停按钮（黑色边框 + 黄色悬停）
- ✅ 进度条（黄色进度 + 可点击跳转）
- ✅ 时间显示（MM:SS 格式）
- ✅ 音量控制（静音按钮 + 滑块）
- ✅ 全屏切换
- ✅ 自动隐藏控制栏（播放时 3 秒后）

### UI 风格
- ✅ 极客新丑风格（黑边框 + 硬核阴影 + 黄色点缀）
- ✅ 白色控制栏背景 + 4px 黑色顶边框
- ✅ 等宽字体时间显示
- ✅ 2px 硬核阴影效果

---

## 🔍 如何查看控制栏

### 方法 1：在开发环境中测试

1. **启动开发服务器**
```bash
cd /Users/kamisama/workspace/loaf-drive
pnpm run dev
```

2. **打开应用并上传/打开一个视频文件**

3. **观察调试指示器**
   - 右上角会显示黄色调试信息框
   - 显示：`Controls: VISIBLE/HIDDEN | Playing: YES/NO`

4. **控制栏显示规则**
   - ✅ 视频加载完成后立即显示
   - ✅ 鼠标移入视频区域时显示
   - ✅ 暂停时保持显示
   - ⏱️ 播放时 3 秒后自动隐藏
   - ✅ 移动鼠标重新显示

---

## 🐛 常见问题排查

### 问题 1：看不到控制栏

**可能原因：**
1. 视频还在加载中（显示 "Loading Video" 提示）
2. 控制栏自动隐藏了（播放 3 秒后）
3. 容器高度不足

**解决方法：**
```typescript
// 方法 A：移动鼠标到视频区域
// 控制栏会立即显示

// 方法 B：暂停视频
// 点击视频画面暂停，控制栏会保持显示

// 方法 C：检查调试指示器
// 查看右上角黄色框，确认 showControls 状态
```

### 问题 2：控制栏被遮挡

**检查容器样式：**
```tsx
// VideoViewer.tsx 中的 className
<CanvasVideo 
  src={item.url} 
  autoplay={true}
  className="h-full w-full"  // ✅ 确保有足够高度
/>
```

**PreviewModal 容器：**
```tsx
// 预览区域应该有足够的高度
<div className="flex-1 overflow-hidden relative bg-gray-100">
  <PreviewContent item={item} />
</div>
```

### 问题 3：控制栏样式不正确

**确认 Tailwind 类名生效：**
- 白色背景：`bg-white`
- 黑色顶边框：`border-t-4 border-black`
- 底部定位：`absolute bottom-0 left-0 right-0`
- z-index：`z-10`

---

## 📊 调试信息说明

### 右上角调试指示器

```
Controls: VISIBLE | Playing: YES
         ↑                    ↑
    控制栏状态            播放状态
```

**状态组合：**
- `VISIBLE + NO` → 暂停状态，控制栏显示 ✅
- `VISIBLE + YES` → 播放中，控制栏显示（刚开始或鼠标移动）✅
- `HIDDEN + YES` → 播放中，控制栏自动隐藏（3秒后）✅
- `HIDDEN + NO` → 不应该出现（暂停时应该显示）⚠️

---

## 🎨 控制栏 UI 结构

```
┌─────────────────────────────────────────────────┐
│  Progress Bar (黄色进度条)                       │
├─────────────────────────────────────────────────┤
│  [▶] 00:42 / 03:25        [🔊] [⛶]              │
│   ↑      ↑                  ↑    ↑              │
│  播放   时间               音量  全屏            │
└─────────────────────────────────────────────────┘
```

### 各元素样式
- **进度条**：高度 12px，灰色背景，黄色进度
- **按钮**：40x40px，白底黑边，悬停变黄
- **时间**：等宽字体，粗体大写
- **音量滑块**：悬停展开，黑色方形手柄

---

## 🧪 测试步骤

### 1. 基础功能测试

```bash
# 1. 启动开发服务器
pnpm run dev

# 2. 打开浏览器访问应用
# 3. 上传一个视频文件（MP4/WebM）
# 4. 点击视频打开预览
```

### 2. 控制栏显示测试

- [ ] 视频加载完成后，控制栏是否显示？
- [ ] 点击播放按钮，视频是否开始播放？
- [ ] 播放 3 秒后，控制栏是否自动隐藏？
- [ ] 移动鼠标，控制栏是否重新显示？
- [ ] 点击暂停，控制栏是否保持显示？

### 3. 进度条测试

- [ ] 进度条是否随播放实时更新？
- [ ] 点击进度条，是否能跳转到对应位置？
- [ ] 悬停进度条，是否显示拖动手柄？

### 4. 音量控制测试

- [ ] 点击音量按钮，是否能静音/取消静音？
- [ ] 悬停音量按钮，滑块是否展开？
- [ ] 拖动滑块，音量是否改变？

### 5. 全屏测试

- [ ] 点击全屏按钮，是否进入全屏？
- [ ] 全屏状态下，控制栏是否正常显示？
- [ ] 退出全屏，是否恢复正常？

---

## 🔧 临时调试代码

### 当前添加的调试代码

```tsx
// 位置：CanvasVideo.tsx 第 328-332 行
{isLoaded && (
  <div className="absolute top-4 right-4 bg-yellow-400 border-2 border-black px-3 py-1 text-xs font-mono font-bold uppercase shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] z-20">
    Controls: {showControls ? 'VISIBLE' : 'HIDDEN'} | Playing: {isPlaying ? 'YES' : 'NO'}
  </div>
)}
```

### 如何移除调试代码

**测试完成后，删除上述代码即可：**
```bash
# 打开文件
vim components/video/CanvasVideo.tsx

# 删除第 328-332 行的调试指示器
# 或者使用编辑器手动删除
```

---

## 📝 预期效果截图说明

### 加载状态
```
┌─────────────────────────────────────┐
│                                     │
│         ┌─────────────────┐         │
│         │  ⟳ Loading      │         │
│         │  LOADING VIDEO  │         │
│         └─────────────────┘         │
│                                     │
└─────────────────────────────────────┘
```

### 播放状态（控制栏显示）
```
┌─────────────────────────────────────┐
│  [Controls: VISIBLE | Playing: YES] │ ← 调试信息
│                                     │
│         视频画面                     │
│                                     │
├─────────────────────────────────────┤ ← 进度条
│  [▶] 00:42 / 03:25    [🔊] [⛶]     │ ← 控制按钮
└─────────────────────────────────────┘
```

### 播放状态（控制栏隐藏）
```
┌─────────────────────────────────────┐
│  [Controls: HIDDEN | Playing: YES]  │ ← 调试信息
│                                     │
│         视频画面                     │
│                                     │
│                                     │
│                                     │ ← 控制栏已隐藏
└─────────────────────────────────────┘
```

---

## 💡 提示

1. **如果看不到控制栏**：
   - 先检查调试指示器状态
   - 尝试移动鼠标到视频区域
   - 点击视频暂停，控制栏会保持显示

2. **如果控制栏样式不对**：
   - 检查 Tailwind CSS 是否正确加载
   - 确认没有其他样式覆盖
   - 查看浏览器开发者工具的 Elements 面板

3. **如果功能不正常**：
   - 打开浏览器控制台查看错误信息
   - 检查 HLS.js 是否正确加载
   - 确认视频格式是否支持

---

## 🎯 下一步

测试完成后，如果一切正常：

1. **移除调试指示器**（第 328-332 行）
2. **根据需要调整自动隐藏时间**（当前 3 秒）
3. **添加键盘快捷键支持**（可选）
4. **优化移动端体验**（可选）

---

**祝测试顺利！如有问题，请查看浏览器控制台的错误信息。** 🎉

